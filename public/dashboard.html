<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Magical Catering System - Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #FF6B6B;
      --primary-light: #FF8E8E;
      --secondary: #4ECDC4;
      --dark: #292F36;
      --light: #F7FFF7;
      --gray: #6C757D;
      --light-gray: #E9ECEF;
      --success: #28A745;
      --warning: #FFC107;
      --danger: #DC3545;
      --shadow: 0 4px 6px rgba(0,0,0,0.1);
      --transition: all 0.3s ease;
      --bg-color: #F8F9FA;
      --card-bg: #FFFFFF;
      --text-color: #292F36;
      --sidebar-bg: #FFFFFF;
    }

    [data-theme="dark"] {
      --bg-color: #1A1A1A;
      --card-bg: #2C2C2C;
      --text-color: #E0E0E0;
      --sidebar-bg: #2C2C2C;
      --light-gray: #3A3A3A;
      --gray: #B0B0B0;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      overflow-x: hidden;
      transition: var(--transition);
    }

    .dashboard-container {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar Styles */
    .sidebar {
      width: 280px;
      background: var(--sidebar-bg);
      padding: 2rem 1.5rem;
      box-shadow: var(--shadow);
      position: fixed;
      height: 100%;
      z-index: 100;
      transition: var(--transition);
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      margin-bottom: 2rem;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--text-color);
      display: flex;
      align-items: center;
    }

    .logo span {
      color: var(--primary);
      margin-left: 0.3rem;
    }

    .sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .nav-item {
      display: flex;
      align-items: center;
      padding: 0.8rem 1rem;
      border-radius: 8px;
      color: var(--gray);
      text-decoration: none;
      transition: var(--transition);
    }

    .nav-item i {
      margin-right: 1rem;
      font-size: 1.1rem;
      width: 24px;
      text-align: center;
    }

    .nav-item:hover {
      background: rgba(255, 107, 107, 0.1);
      color: var(--primary);
    }

    .nav-item.active {
      background: var(--primary);
      color: white;
    }

    /* Main Content Styles */
    .main-content {
      flex: 1;
      margin-left: 280px;
      padding: 2rem;
      transition: var(--transition);
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .header-title h2 {
      font-size: 1.8rem;
      font-weight: 600;
    }

    .header-title p {
      color: var(--gray);
      font-size: 0.9rem;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .search-bar {
      position: relative;
    }

    .search-bar input {
      padding: 0.6rem 1rem 0.6rem 2.5rem;
      border: 1px solid var(--light-gray);
      border-radius: 30px;
      width: 250px;
      background: var(--card-bg);
      color: var(--text-color);
      transition: var(--transition);
    }

    .search-bar input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.2);
    }

    .search-bar i {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
    }

    .theme-toggle {
      cursor: pointer;
      font-size: 1.2rem;
      color: var(--gray);
    }

    .theme-toggle:hover {
      color: var(--primary);
    }

    .logout-button {
      padding: 0.5rem 1rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
      transition: var(--transition);
    }

    .logout-button:hover {
      background: var(--primary-light);
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--card-bg);
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--primary);
    }

    .stat-content {
      display: flex;
      justify-content: space-between;
    }

    .stat-text h3 {
      font-size: 0.9rem;
      color: var(--gray);
      font-weight: 500;
      margin-bottom: 0.5rem;
    }

    .stat-text p {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--text-color);
    }

    .stat-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(255, 107, 107, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      font-size: 1.2rem;
    }

    /* Data Tables */
    .data-section {
      background: var(--card-bg);
      border-radius: 10px;
      box-shadow: var(--shadow);
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .section-header h3 {
      font-size: 1.3rem;
      font-weight: 600;
    }

    .table-responsive {
      overflow-x: auto;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
    }

    .data-table th {
      background: var(--light-gray);
      padding: 0.8rem 1rem;
      text-align: left;
      font-weight: 600;
      color: var(--gray);
      font-size: 0.9rem;
    }

    .data-table td {
      padding: 1rem;
      border-bottom: 1px solid var(--light-gray);
      font-size: 0.95rem;
    }

    .status-badge {
      display: inline-block;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    .status-confirmed {
      background: #D4EDDA;
      color: #155724;
    }

    .status-pending {
      background: #FFF3CD;
      color: #856404;
    }

    .status-completed {
      background: #C3E6CB;
      color: #155724;
    }

    .status-available {
      background: #D4EDDA;
      color: #155724;
    }

    .status-unavailable {
      background: #F8D7DA;
      color: #721C24;
    }

    .btn {
      padding: 0.5rem 1rem;
      border-radius: 5px;
      border: none;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-light);
    }

    .btn-outline {
      background: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
    }

    .btn-outline:hover {
      background: rgba(255, 107, 107, 0.1);
    }

    .btn-sm {
      padding: 0.3rem 0.8rem;
      font-size: 0.85rem;
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      background: #c82333;
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-success:hover {
      background: #218838;
    }

    .action-buttons {
      display: flex;
      gap: 0.5rem;
    }

    /* Reservation Form */
    .reservation-form {
      background: var(--card-bg);
      border-radius: 10px;
      box-shadow: var(--shadow);
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid var(--light-gray);
      border-radius: 5px;
      font-size: 1rem;
      background: var(--card-bg);
      color: var(--text-color);
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    /* Chart Section */
    .chart-section {
      background: var(--card-bg);
      border-radius: 10px;
      box-shadow: var(--shadow);
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--primary);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      display: none;
      font-weight: 500;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .notification.error {
      background: var(--danger);
    }

    .notification.show {
      display: block;
      animation: slideInRight 0.3s ease;
    }

    @keyframes slideInRight {
      from { transform: translateX(100%); }
      to { transform: translateX(0); }
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal {
      background: var(--card-bg);
      padding: 2rem;
      border-radius: 10px;
      max-width: 500px;
      width: 90%;
      position: relative;
      animation: fadeIn 0.3s ease;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .modal-header h3 {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--gray);
    }

    .modal-close:hover {
      color: var(--primary);
    }

    .modal-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .modal-overlay.show {
      display: flex;
    }

    /* Responsive Design */
    @media (max-width: 992px) {
      .sidebar {
        width: 80px;
        padding: 1.5rem 0.5rem;
      }

      .sidebar-header .logo-text {
        display: none;
      }

      .nav-item span {
        display: none;
      }

      .nav-item i {
        margin-right: 0;
        font-size: 1.3rem;
      }

      .main-content {
        margin-left: 80px;
      }
    }

    @media (max-width: 768px) {
      .search-bar input {
        width: 180px;
      }

      .stats-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 576px) {
      .main-content {
        padding: 1.5rem 1rem;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .header-actions {
        gap: 1rem;
      }

      .search-bar input {
        width: 150px;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <i class="fas fa-utensils"></i>
          <span class="logo-text">MagicalCatering</span>
        </div>
      </div>
      
      <nav class="sidebar-nav" id="sidebar-nav">
        <a href="/index.html" class="nav-item active" data-tab="home">
          <i class="fas fa-tachometer-alt"></i>
          <span>Home</span>   
        </a>
        <a href="#dashboard-content" class="nav-item active" data-tab="dashboard">
          <i class="fas fa-home"></i>
          <span>Dashboard</span>
        </a>
        <a href="#orders-content" class="nav-item" data-tab="orders">
          <i class="fas fa-shopping-basket"></i>
          <span>Orders</span>
        </a>
        <a href="#reservations-content" class="nav-item" data-tab="reservations">
          <i class="fas fa-calendar-check"></i>
          <span>Reservations</span>
        </a>
        <a href="#new-reservation-content" class="nav-item" data-tab="new-reservation">
          <i class="fas fa-plus-circle"></i>
          <span>New Reservation</span>
        </a>
        <!-- Admin-only tabs will be added dynamically -->
      </nav>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
      <!-- Dashboard Header -->
      <header class="dashboard-header" id="dashboard">
        <div class="header-title">
          <h2 id="welcome-message">Loading...</h2>
          <p id="current-date"></p>
        </div>
        
        <div class="header-actions">
          <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="Search...">
          </div>
          
          <div class="theme-toggle" id="theme-toggle">
            <i class="fas fa-moon"></i>
          </div>
          
          <button class="logout-button" id="logout-button">Logout</button>
        </div>
      </header>

      <!-- Dashboard Tab -->
      <div class="tab-content active" id="dashboard-content">
        <!-- Stats Overview -->
        <div class="stats-grid" id="stats-grid">
          <!-- Stats will be populated based on role -->
        </div>

        <!-- Chart Section -->
        <div class="chart-section">
          <div class="section-header">
            <h3>Revenue Trend</h3>
          </div>
          <canvas id="revenue-chart"></canvas>
        </div>

        <!-- Orders Section -->
        <div class="data-section">
          <div class="section-header">
            <h3>Recent Orders</h3>
            <button class="btn btn-outline">View All</button>
          </div>
          
          <div class="table-responsive">
            <table class="data-table" id="recent-orders-table">
              <thead>
                <tr>
                  <th>Order ID</th>
                  <th>Customer</th>
                  <th>Date</th>
                  <th>Amount</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <!-- Populated dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Orders Tab -->
      <div class="tab-content" id="orders-content">
        <div class="data-section">
          <div class="section-header">
            <h3>Order History</h3>
            <button class="btn btn-primary" id="place-order-btn">Place New Order</button>
          </div>
          
          <div class="table-responsive">
            <table class="data-table" id="orders-table">
              <thead>
                <tr>
                  <th>Order ID</th>
                  <th>Customer</th>
                  <th>Date</th>
                  <th>Amount</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <!-- Populated dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Reservations Tab -->
      <div class="tab-content" id="reservations-content">
        <div class="data-section">
          <div class="section-header">
            <h3>Reservations</h3>
            <button class="btn btn-outline">View All</button>
          </div>
          
          <div class="table-responsive">
            <table class="data-table" id="reservations-table">
              <thead>
                <tr>
                  <th>Event Name</th>
                  <th>Date</th>
                  <th>Time</th>
                  <th>Guests</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <!-- Populated dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- New Reservation Tab -->
      <div class="tab-content" id="new-reservation-content">
        <div class="reservation-form">
          <h2>New Reservation Request</h2>
          <p>Click below to request a catering reservation</p>
          <button class="btn btn-primary" id="submit-reservation">Book New Reservation</button>
        </div>
      </div>

      <!-- Menu Tab (Admin Only) -->
      <div class="tab-content" id="menu-content">
        <div class="data-section">
          <div class="section-header">
            <h3>Menu Management</h3>
            <button class="btn btn-primary" id="add-menu-item-btn">Add New Item</button>
          </div>
          
          <div class="table-responsive">
            <table class="data-table" id="menu-table">
              <thead>
                <tr>
                  <th>Item Name</th>
                  <th>Description</th>
                  <th>Price</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <!-- Populated dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Customers Tab (Admin Only) -->
      <div class="tab-content" id="customers-content">
        <div class="data-section">
          <div class="section-header">
            <h3>Customer Management</h3>
            <button class="btn btn-primary">Add New Customer</button>
          </div>
          
          <div class="table-responsive">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Customer Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Events</th>
                  <th>Last Order</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>John Smith</td>
                  <td>john@example.com</td>
                  <td>(555) 123-4567</td>
                  <td>5</td>
                  <td>Mar 10, 2024</td>
                  <td><button class="btn btn-outline btn-sm">Edit</button></td>
                </tr>
                <tr>
                  <td>Sarah Johnson</td>
                  <td>sarah@example.com</td>
                  <td>(555) 987-6543</td>
                  <td>2</td>
                  <td>Feb 28, 2024</td>
                  <td><button class="btn btn-outline btn-sm">Edit</button></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Modal for Forms -->
  <div class="modal-overlay" id="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 id="modal-title"></h3>
        <button class="modal-close" id="modal-close">×</button>
      </div>
      <form class="modal-form" id="modal-form">
        <div id="modal-form-content"></div>
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>
  </div>

  <div class="notification" id="notification"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, addDoc, serverTimestamp, getDocs, updateDoc, deleteDoc, query, where } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCTMagK8zneRb7DjWbFO9CgV03z7Khmy3g",
      authDomain: "cateringreservationorderingsys.firebaseapp.com",
      projectId: "cateringreservationorderingsys",
      storageBucket: "cateringreservationorderingsys.firebasestorage.app",
      messagingSenderId: "737129861298",
      appId: "1:737129861298:web:9f35ebc42b566b475039ab",
      measurementId: "G-F7FYE2NDF3"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Notification function
    function showNotification(message, type = 'info') {
      const notification = document.getElementById('notification');
      if (notification) {
        notification.textContent = message;
        notification.className = `notification ${type} show`;
        setTimeout(() => notification.classList.remove('show'), 3000);
      }
    }

    // Theme toggle
    const themeToggle = document.getElementById('theme-toggle');
    function setTheme(theme) {
      document.body.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      themeToggle.innerHTML = theme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    }
    const savedTheme = localStorage.getItem('theme') || 'light';
    setTheme(savedTheme);
    themeToggle.addEventListener('click', () => {
      const newTheme = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      setTheme(newTheme);
    });

    // Update current date
    const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', dateOptions);

    // Tab functionality with smooth scrolling
    function setupTabs() {
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', function(e) {
          e.preventDefault();
          const tabId = this.getAttribute('data-tab');
          const sectionId = this.getAttribute('href').substring(1);
          
          document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
          this.classList.add('active');
          
          document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
          const targetSection = document.getElementById(`${tabId}-content`);
          targetSection.classList.add('active');

          const sectionElement = document.getElementById(sectionId);
          if (sectionElement) {
            sectionElement.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
      });
    }

    // Chart setup
    function setupChart() {
      const ctx = document.getElementById('revenue-chart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
          datasets: [{
            label: 'Revenue ($)',
            data: [5000, 7000, 9000, 6000, 8000, 10000],
            borderColor: 'rgb(255, 107, 107)',
            backgroundColor: 'rgba(255, 107, 107, 0.2)',
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    // Modal functionality
    const modalOverlay = document.getElementById('modal-overlay');
    const modalTitle = document.getElementById('modal-title');
    const modalFormContent = document.getElementById('modal-form-content');
    const modalForm = document.getElementById('modal-form');
    const modalClose = document.getElementById('modal-close');
    let currentDocId = null;
    let currentType = null;

    function openModal(type, data = null, docId = null) {
      currentType = type;
      currentDocId = docId;
      modalOverlay.classList.add('show');
      
      if (type === 'order') {
        modalTitle.textContent = data ? 'Edit Order' : 'Place New Order';
        modalFormContent.innerHTML = `
          <div class="form-group">
            <label for="order-item">Item Name</label>
            <input type="text" id="order-item" value="${data?.items?.[0]?.name || ''}" required>
          </div>
          <div class="form-group">
            <label for="order-quantity">Quantity</label>
            <input type="number" id="order-quantity" min="1" value="${data?.items?.[0]?.quantity || 1}" required>
          </div>
          <div class="form-group">
            <label for="order-amount">Total Amount (USD)</label>
            <input type="number" id="order-amount" min="0" step="0.01" value="${data?.totalAmount || ''}" required>
          </div>
          <div class="form-group">
            <label for="order-status">Status</label>
            <select id="order-status" required>
              <option value="Pending" ${data?.status === 'Pending' ? 'selected' : ''}>Pending</option>
              <option value="Confirmed" ${data?.status === 'Confirmed' ? 'selected' : ''}>Confirmed</option>
              <option value="Completed" ${data?.status === 'Completed' ? 'selected' : ''}>Completed</option>
            </select>
          </div>
        `;
      } else if (type === 'reservation') {
        modalTitle.textContent = data ? 'Edit Reservation' : 'Book New Reservation';
        modalFormContent.innerHTML = `
          <div class="form-group">
            <label for="event-type">Event Type</label>
            <select id="event-type" required>
              <option value="">Select Event Type</option>
              <option value="wedding" ${data?.eventType === 'wedding' ? 'selected' : ''}>Wedding</option>
              <option value="corporate" ${data?.eventType === 'corporate' ? 'selected' : ''}>Corporate Event</option>
              <option value="birthday" ${data?.eventType === 'birthday' ? 'selected' : ''}>Birthday Party</option>
              <option value="other" ${data?.eventType === 'other' ? 'selected' : ''}>Other</option>
            </select>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="event-date">Event Date</label>
              <input type="date" id="event-date" value="${data?.date || ''}" required>
            </div>
            <div class="form-group">
              <label for="event-time">Event Time</label>
              <input type="time" id="event-time" value="${data?.time || ''}" required>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="guests">Number of Guests</label>
              <input type="number" id="guests" min="1" value="${data?.guests || 50}" required>
            </div>
            <div class="form-group">
              <label for="budget">Budget (USD)</label>
              <input type="number" id="budget" min="100" value="${data?.budget || 1000}" required>
            </div>
          </div>
          <div class="form-group">
            <label for="event-location">Event Location</label>
            <input type="text" id="event-location" value="${data?.location || ''}" placeholder="Enter event address" required>
          </div>
          <div class="form-group">
            <label for="special-requests">Special Requests</label>
            <textarea id="special-requests" rows="3" placeholder="Any dietary restrictions, special arrangements, etc.">${data?.requests || ''}</textarea>
          </div>
          <div class="form-group">
            <label for="reservation-status">Status</label>
            <select id="reservation-status" required>
              <option value="Pending" ${data?.status === 'Pending' ? 'selected' : ''}>Pending</option>
              <option value="Confirmed" ${data?.status === 'Confirmed' ? 'selected' : ''}>Confirmed</option>
              <option value="Completed" ${data?.status === 'Completed' ? 'selected' : ''}>Completed</option>
            </select>
          </div>
        `;
      } else if (type === 'menu') {
        modalTitle.textContent = data ? 'Edit Menu Item' : 'Add New Menu Item';
        modalFormContent.innerHTML = `
          <div class="form-group">
            <label for="menu-name">Item Name</label>
            <input type="text" id="menu-name" value="${data?.name || ''}" required>
          </div>
          <div class="form-group">
            <label for="menu-description">Description</label>
            <textarea id="menu-description" rows="3" required>${data?.description || ''}</textarea>
          </div>
          <div class="form-group">
            <label for="menu-price">Price (USD/guest)</label>
            <input type="number" id="menu-price" min="0" step="0.01" value="${data?.price || ''}" required>
          </div>
          <div class="form-group">
            <label for="menu-status">Status</label>
            <select id="menu-status" required>
              <option value="Available" ${data?.status === 'Available' ? 'selected' : ''}>Available</option>
              <option value="Unavailable" ${data?.status === 'Unavailable' ? 'selected' : ''}>Unavailable</option>
            </select>
          </div>
        `;
      }
    }

    function closeModal() {
      modalOverlay.classList.remove('show');
      modalFormContent.innerHTML = '';
      currentDocId = null;
      currentType = null;
    }

    modalClose.addEventListener('click', closeModal);
    modalOverlay.addEventListener('click', (e) => {
      if (e.target === modalOverlay) closeModal();
    });

    // Form submission handler
    modalForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        if (currentType === 'order') {
          const item = document.getElementById('order-item').value;
          const quantity = parseInt(document.getElementById('order-quantity').value);
          const totalAmount = parseFloat(document.getElementById('order-amount').value);
          const status = document.getElementById('order-status').value;
          const userUid = localStorage.getItem('userUid');

          if (!userUid) throw new Error('User not logged in.');

          const orderData = {
            customerId: userUid,
            items: [{ name: item, quantity }],
            totalAmount,
            status,
            createdAt: serverTimestamp()
          };

          if (currentDocId) {
            await updateDoc(doc(db, 'orders', currentDocId), orderData);
            showNotification('Order updated successfully!', 'success');
          } else {
            await addDoc(collection(db, 'orders'), orderData);
            showNotification('Order placed successfully!', 'success');
          }
        } else if (currentType === 'reservation') {
          const eventType = document.getElementById('event-type').value;
          const date = document.getElementById('event-date').value;
          const time = document.getElementById('event-time').value;
          const guests = parseInt(document.getElementById('guests').value);
          const budget = parseFloat(document.getElementById('budget').value);
          const location = document.getElementById('event-location').value;
          const requests = document.getElementById('special-requests').value;
          const status = document.getElementById('reservation-status').value;
          const userUid = localStorage.getItem('userUid');

          if (!userUid) throw new Error('User not logged in.');

          const reservationData = {
            customerId: userUid,
            eventType,
            date,
            time,
            guests,
            budget,
            location,
            requests,
            status,
            createdAt: serverTimestamp()
          };

          if (currentDocId) {
            await updateDoc(doc(db, 'reservations', currentDocId), reservationData);
            showNotification('Reservation updated successfully!', 'success');
          } else {
            await addDoc(collection(db, 'reservations'), reservationData);
            showNotification('Reservation booked successfully!', 'success');
          }
        } else if (currentType === 'menu') {
          const name = document.getElementById('menu-name').value;
          const description = document.getElementById('menu-description').value;
          const price = parseFloat(document.getElementById('menu-price').value);
          const status = document.getElementById('menu-status').value;

          const menuData = {
            name,
            description,
            price,
            status,
            createdAt: serverTimestamp()
          };

          if (currentDocId) {
            await updateDoc(doc(db, 'menu', currentDocId), menuData);
            showNotification('Menu item updated successfully!', 'success');
          } else {
            await addDoc(collection(db, 'menu'), menuData);
            showNotification('Menu item added successfully!', 'success');
          }
        }

        closeModal();
        // Refresh tables after submission
        await loadOrders();
        await loadReservations();
        await loadMenu();
      } catch (error) {
        showNotification(`Error: ${error.message}`, 'error');
        console.error('Firestore error:', error);
      }
    });

    // Load data functions
    async function loadOrders() {
      const userUid = localStorage.getItem('userUid');
      const userRole = localStorage.getItem('userRole');
      console.log('Loading orders for userUid:', userUid, 'with role:', userRole);
      const ordersTable = document.querySelector('#orders-table tbody');
      const recentOrdersTable = document.querySelector('#recent-orders-table tbody');
      ordersTable.innerHTML = '';
      recentOrdersTable.innerHTML = '';

      let ordersQuery;
      if (userRole === 'admin') {
        ordersQuery = collection(db, 'orders');
      } else {
        ordersQuery = query(collection(db, 'orders'), where('customerId', '==', userUid));
      }

      try {
        const ordersSnap = await getDocs(ordersQuery);
        let recentCount = 0;
        const recentLimit = 2;

        for (const orderDoc of ordersSnap.docs) {
          const order = orderDoc.data();
          const orderRow = `
            <tr data-id="${orderDoc.id}">
              <td>#${orderDoc.id.slice(0, 5)}</td>
              <td>${order.customerId.slice(0, 5)}</td>
              <td>${order.createdAt?.toDate().toLocaleDateString() || 'N/A'}</td>
              <td>$${order.totalAmount}</td>
              <td><span class="status-badge status-${order.status.toLowerCase()}">${order.status}</span></td>
              <td class="action-buttons">
                <button class="btn btn-primary btn-sm edit-order">Edit</button>
                <button class="btn btn-danger btn-sm delete-order">Delete</button>
                <button class="btn btn-success btn-sm done-order">Done</button>
              </td>
            </tr>
          `;

          ordersTable.innerHTML += orderRow;
          if (recentCount < recentLimit) {
            recentOrdersTable.innerHTML += orderRow;
            recentCount++;
          }
        }
      } catch (error) {
        console.error('Error loading orders:', error);
        showNotification(`Error loading orders: ${error.message}`, 'error');
      }

      setupActionButtons('order');
    }

    async function loadReservations() {
      const userUid = localStorage.getItem('userUid');
      const userRole = localStorage.getItem('userRole');
      console.log('Loading reservations for userUid:', userUid, 'with role:', userRole);
      const reservationsTable = document.querySelector('#reservations-table tbody');
      reservationsTable.innerHTML = '';

      let reservationsQuery;
      if (userRole === 'admin') {
        reservationsQuery = collection(db, 'reservations');
      } else {
        reservationsQuery = query(collection(db, 'reservations'), where('customerId', '==', userUid));
      }

      try {
        const reservationsSnap = await getDocs(reservationsQuery);
        for (const resDoc of reservationsSnap.docs) {
          const res = resDoc.data();
          const reservationRow = `
            <tr data-id="${resDoc.id}">
              <td>${res.eventType.charAt(0).toUpperCase() + res.eventType.slice(1)}</td>
              <td>${res.date}</td>
              <td>${res.time}</td>
              <td>${res.guests}</td>
              <td><span class="status-badge status-${res.status.toLowerCase()}">${res.status}</span></td>
              <td class="action-buttons">
                <button class="btn btn-primary btn-sm edit-reservation">Edit</button>
                <button class="btn btn-danger btn-sm delete-reservation">Delete</button>
                <button class="btn btn-success btn-sm done-reservation">Done</button>
              </td>
            </tr>
          `;
          reservationsTable.innerHTML += reservationRow;
        }
      } catch (error) {
        console.error('Error loading reservations:', error);
        showNotification(`Error loading reservations: ${error.message}`, 'error');
      }

      setupActionButtons('reservation');
    }

    async function loadMenu() {
      const userRole = localStorage.getItem('userRole');
      if (userRole !== 'admin') return; // Menu is admin-only
      console.log('Loading menu for role:', userRole);
      const menuTable = document.querySelector('#menu-table tbody');
      menuTable.innerHTML = '';

      try {
        const menuSnap = await getDocs(collection(db, 'menu'));
        for (const menuDoc of menuSnap.docs) {
          const item = menuDoc.data();
          const menuRow = `
            <tr data-id="${menuDoc.id}">
              <td>${item.name}</td>
              <td>${item.description}</td>
              <td>$${item.price}/guest</td>
              <td><span class="status-badge status-${item.status.toLowerCase()}">${item.status}</span></td>
              <td class="action-buttons">
                <button class="btn btn-primary btn-sm edit-menu">Edit</button>
                <button class="btn btn-danger btn-sm delete-menu">Delete</button>
                <button class="btn btn-success btn-sm done-menu" style="display: none;">Done</button>
              </td>
            </tr>
          `;
          menuTable.innerHTML += menuRow;
        }
      } catch (error) {
        console.error('Error loading menu:', error);
        showNotification(`Error loading menu: ${error.message}`, 'error');
      }

      setupActionButtons('menu');
    }

    // Setup action buttons
    function setupActionButtons(type) {
      // Edit buttons
      document.querySelectorAll(`.edit-${type}`).forEach(button => {
        button.addEventListener('click', async () => {
          const row = button.closest('tr');
          const docId = row.getAttribute('data-id');
          const docRef = doc(db, type + 's', docId);
          try {
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
              openModal(type, docSnap.data(), docId);
            } else {
              showNotification('Document not found.', 'error');
            }
          } catch (error) {
            showNotification(`Error: ${error.message}`, 'error');
            console.error(`Error fetching ${type} for edit:`, error);
          }
        });
      });

      // Delete buttons
      document.querySelectorAll(`.delete-${type}`).forEach(button => {
        button.addEventListener('click', async () => {
          const row = button.closest('tr');
          const docId = row.getAttribute('data-id');
          if (confirm(`Are you sure you want to delete this ${type}?`)) {
            try {
              await deleteDoc(doc(db, type + 's', docId));
              row.remove();
              showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} deleted successfully!`, 'success');
              await loadOrders();
              await loadReservations();
              await loadMenu();
            } catch (error) {
              showNotification(`Error: ${error.message}`, 'error');
              console.error(`Error deleting ${type}:`, error);
            }
          }
        });
      });

      // Done buttons (not applicable for menu)
      if (type !== 'menu') {
        document.querySelectorAll(`.done-${type}`).forEach(button => {
          button.addEventListener('click', async () => {
            const row = button.closest('tr');
            const docId = row.getAttribute('data-id');
            try {
              await updateDoc(doc(db, type + 's', docId), { status: 'Completed' });
              const statusCell = row.querySelector('.status-badge');
              statusCell.className = 'status-badge status-completed';
              statusCell.textContent = 'Completed';
              showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} marked as completed!`, 'success');
            } catch (error) {
              showNotification(`Error: ${error.message}`, 'error');
              console.error(`Error marking ${type} as done:`, error);
            }
          });
        });
      }
    }

    // Button handlers
    document.getElementById('place-order-btn').addEventListener('click', () => {
      openModal('order');
    });

    document.getElementById('submit-reservation').addEventListener('click', (e) => {
      e.preventDefault();
      openModal('reservation');
    });

    document.getElementById('add-menu-item-btn').addEventListener('click', () => {
      openModal('menu');
    });

    // Authentication and role-based setup
    onAuthStateChanged(auth, async (user) => {
      const welcomeMessage = document.getElementById('welcome-message');
      const sidebarNav = document.getElementById('sidebar-nav');
      const statsGrid = document.getElementById('stats-grid');
      
      if (user && user.emailVerified) {
        try {
          const userDoc = await getDoc(doc(db, 'users', user.uid));
          if (userDoc.exists()) {
            const userData = userDoc.data();
            const role = userData.role;
            console.log('User data:', userData);
            welcomeMessage.textContent = `Welcome back, ${user.displayName || 'User'}!`;
            localStorage.setItem('userUid', user.uid);
            localStorage.setItem('userRole', role);

            // Role-based sidebar
            if (role === 'admin') {
              sidebarNav.innerHTML += `
                <a href="#menu-content" class="nav-item" data-tab="menu">
                  <i class="fas fa-book"></i>
                  <span>Menu</span>
                </a>
                <a href="#customers-content" class="nav-item" data-tab="customers">
                  <i class="fas fa-users"></i>
                  <span>Customers</span>
                </a>
              `;
              statsGrid.innerHTML = `
                <div class="stat-card">
                  <div class="stat-content">
                    <div class="stat-text">
                      <h3>Total Orders</h3>
                      <p>1,245</p>
                    </div>
                    <div class="stat-icon"><i class="fas fa-shopping-basket"></i></div>
                  </div>
                </div>
                <div class="stat-card">
                  <div class="stat-content">
                    <div class="stat-text">
                      <h3>Upcoming Events</h3>
                      <p>18</p>
                    </div>
                    <div class="stat-icon"><i class="fas fa-calendar-alt"></i></div>
                  </div>
                </div>
                <div class="stat-card">
                  <div class="stat-content">
                    <div class="stat-text">
                      <h3>Revenue</h3>
                      <p>$24,580</p>
                    </div>
                    <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                  </div>
                </div>
                <div class="stat-card">
                  <div class="stat-content">
                    <div class="stat-text">
                      <h3>Pending Orders</h3>
                      <p>7</p>
                    </div>
                    <div class="stat-icon"><i class="fas fa-clock"></i></div>
                  </div>
                </div>
              `;
            } else if (role === 'customer') {
              statsGrid.innerHTML = `
                <div class="stat-card">
                  <div class="stat-content">
                    <div class="stat-text">
                      <h3>My Orders</h3>
                      <p>5</p>
                    </div>
                    <div class="stat-icon"><i class="fas fa-shopping-basket"></i></div>
                  </div>
                </div>
                <div class="stat-card">
                  <div class="stat-content">
                    <div class="stat-text">
                      <h3>Upcoming Reservations</h3>
                      <p>2</p>
                    </div>
                    <div class="stat-icon"><i class="fas fa-calendar-alt"></i></div>
                  </div>
                </div>
              `;
              document.getElementById('place-order-btn').style.display = 'block';
            } else {
              showNotification('Invalid user role.', 'error');
              setTimeout(() => window.location.href = 'login.html', 1500);
              return;
            }

            setupTabs();
            setupChart();
            await loadOrders();
            await loadReservations();
            await loadMenu();
          } else {
            showNotification('User data not found. Please register again.', 'error');
            setTimeout(() => window.location.href = 'login.html', 1500);
          }
        } catch (error) {
          showNotification(`Error: ${error.message}`, 'error');
          console.error('Auth error:', error);
          setTimeout(() => window.location.href = 'login.html', 1500);
        }
      } else {
        showNotification('Please log in to access the dashboard.', 'error');
        setTimeout(() => window.location.href = 'login.html', 1500);
      }
    });

    // Logout handler
    document.getElementById('logout-button').addEventListener('click', async () => {
      try {
        await signOut(auth);
        localStorage.removeItem('userUid');
        localStorage.removeItem('userRole');
        showNotification('Successfully logged out!', 'success');
        setTimeout(() => window.location.href = 'login.html', 1500);
      } catch (error) {
        showNotification(`Logout failed: ${error.message}`, 'error');
        console.error('Logout error:', error);
      }
    });
  </script>
</body>
</html>